pipeline {
    agent any

    environment {
        BUILD_CONFIGURATION = 'Release'
        PROJECT_FILE = 'HouseRentingSystem.Web/HouseRentingSystem.Web.csproj'
        TEST_PROJECT = 'HouseRentingSystem.Tests/HouseRentingSystem.Tests.csproj'
        PUBLISH_DIR = 'published'
    }

    stages {
        stage('Restore') {
            steps {
                bat "dotnet restore %PROJECT_FILE%"
            }
        }

        stage('Build') {
            steps {
                bat "dotnet build %PROJECT_FILE% --configuration %BUILD_CONFIGURATION% --no-restore"
            }
        }

        stage('Test') {
            steps {
                bat "dotnet test %TEST_PROJECT% --configuration %BUILD_CONFIGURATION% --no-build"
            }
        }

        stage('Publish') {
            steps {
                bat "dotnet publish %PROJECT_FILE% --configuration %BUILD_CONFIGURATION% --output %PUBLISH_DIR% --no-build"
            }
        }

        stage('Deploy') {
            steps {
                bat "xcopy /Y /E /I %PUBLISH_DIR%\\* \"C:\\inetpub\\wwwroot\\HouseRentingSystem\\\""
            }
        }
    }

    post {
        always {
            echo 'Cleaning up...'
        }
        success {
            echo 'Pipeline completed successfully.'
        }
        failure {
            echo 'Pipeline failed.'
        }
    }
}